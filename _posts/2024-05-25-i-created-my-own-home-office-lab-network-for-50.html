---
layout: post
title: I created my own home ‘office’ LAB network for $50
tag:
- fortigate
- cisco
- network-security
---

<iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fgiphy.com%2Fembed%2FfQZX2aoRC1Tqw%2Ftwitter%2Fiframe&amp;display_name=Giphy&amp;url=https%3A%2F%2Fmedia.giphy.com%2Fmedia%2FfQZX2aoRC1Tqw%2Fgiphy.gif%3Fcid%3D790b7611v4dwwyrhhg8cno4rbvgbxkmquosn775qtcy836dc%26ep%3Dv1_gifs_search%26rid%3Dgiphy.gif%26ct%3Dg&amp;image=https%3A%2F%2Fmedia1.giphy.com%2Fmedia%2Fv1.Y2lkPTc5MGI3NjExejJtZTlsd3hudjNyN2gzZ2w1dXZtNTlpOWNyMmlkcHNyb2FtcGI4bSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw%2FfQZX2aoRC1Tqw%2Fgiphy.gif&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=giphy" width="435" height="246" frameborder="0" scrolling="no"><a href="https://medium.com/media/d0d609b70de63ff651a7bedc69bb9ec4/href">https://medium.com/media/d0d609b70de63ff651a7bedc69bb9ec4/href</a></iframe><p>This is not a clickbait. I’ve literally got my second-hand network equipment from this article through Yahoo! Auction for around $50 (7,500 YEN) in total. Yes, this cheap! I’ve always wanted to set up my own devices at my own expense, and try to break the equipment without worrying of my company costs.</p><p>I live an hour away from Tokyo (Chiba prefecture) so I was able to get myself these devices for a reasonable cheap prices through Yahoo! Auction. For those who are wondering, this is like Ebay. Unfortunately, this is exclusively from Japan only. Now enough chitchats, and I’ll go over how I manage to factory reset, and configure my basic office LAB network.<br>For this project, I used Cisco Catalyst 3560 Series 24-Port, Fortigate 200D firewall, and 2 Fortinet AP822i V2. Unfortunately, these APs that I purchased was defective, so I was not able to completely test and configure them until the end.</p><h3>Network Switch setup</h3><h4>1. Connect to the switch console</h4><p>I used my Kali Linux-based OS laptop on this project since this is the only spare laptop I have at the moment. I connected the USB console cable from the switch console port to my laptop USB port. Since I connected from a Linux machine, there is a different way to find the console connection. Normally, when you putty into a machine from a Windows machine, you can easily find the port connection from the Device Manager. But from this Linux machine, I would have to go /dev and find the USB port connection. Note from this picture that the port is <strong>ttyUSB0</strong>. So I opened up a Putty session, click on Serial and type the absolute path of this because as you may have already know, everything on Linux is file.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*cp1brkL_xKE0-O6toY8E5g.png" /></figure><blockquote>Now that I’ve got my connection to the switch, time to reset the configuration.</blockquote><h4>2. Reset and delete old VLAN configuration</h4><p>I’ve got my Catalyst 3560 switch already reset but just to be sure, I reset it myself anyway. You will need to power down the switch, power it back on with the mode button pressed. You will eventually arrive at the <strong>switch:</strong> prompt. Note that I am deleting the VLAN configuration as well, since this is not automatically deleted when you do a normal factory reset on a used network switch.</p><pre>flash_init<br>delete flash:config.text<br>delete flash:vlan.dat<br>boot</pre><blockquote>I got this screen from below from my switch after the hard reset, so it should be done.</blockquote><figure><img alt="" src="https://cdn-images-1.medium.com/max/812/1*iugb0TRCRALAB-Kzu2bxkA.png" /><figcaption>Image 2</figcaption></figure><h4>3. Basic switch configuration</h4><p>I created some passwords for login first as a general security measure. Enabled the line vty for few connections as well as a baseline. Passwords I created I created below are just temporary(maybe).</p><pre>enable<br>conf t<br>enable password cisco<br>enable secret cisco-secret<br>line vty 0 4<br>login<br>password cisco</pre><p>Now I enabled the VTP or VLAN Trunking Protocol to transpare. I wouldn’t go into details of every things so I would just have to let your curiosity roll. I have created the VLANs that I am planning to use. I only planned on creating 2 VLANs. <strong>VLAN 10 </strong>for management/dev VLAN and <strong>VLAN 100</strong> for the USERNET/DHCP server.</p><pre>vtp mode transparent<br>vtp domain homelab<br>vlan 10<br>vlan 100</pre><figure><img alt="" src="https://cdn-images-1.medium.com/max/309/1*leeF2W8rVPl3KOpB0PcW3Q.png" /></figure><p>Next, I have created the DHCP server for the supposed network for the ‘users. I excluded the network’s broadcast address as well as to not automatically lease the broadcast address, resulting into issues with the network.</p><pre><br>Ip dhcp pool NAME<br>network 192.168.100.1 255.255.255.0<br>Default-gateway 192.168.100.254<br>Dns-server 192.168.100.254<br><br>Lease 1<br>Domain-name google.com<br>Exit<br><br>Ip dhcp excluded-address 192.168.100.254<br>End</pre><p>At this point, I have assigned the switchports into their respective VLANs. I enabled the STP and bpduguard on this switch to avoid the loop if you introduce another switch on the network. Note that this may only apply on older switches.</p><pre>int range fa0/1-12<br>switchport mode access<br>switchport access vlan 100<br>switchport nonegotiate<br>shut<br>no shut<br>exit<br><br>int range fa0/13-24<br>switchport trunk encapsulation dot1q<br>switchport mode trunk<br>switchport access vlan 10<br>switchport nonegotiate<br>switchport protected<br><br>spanning-tree bpduguard enable<br>spanning-tree portfast trunk</pre><p>Now, I have assigned management IP addresses on these VLAN. And that is it for now, for my basic switch configuration until running point. I saved the configuration using ‘wr’ as a shortcut to save all the configurations made. You can also do ‘copy running-config startup-config’ and it will do the same result.</p><pre>conf t<br>int vlan 10<br>ip address 10.10.10.1 255.255.255.0<br>exit<br>int vlan 100<br>ip address 192.168.100.1 255.255.255.0<br>exit<br>wr</pre><h4>4. Basic firewall configuration</h4><p>Now that I have the switch config in place, I will need to power up my firewall and console into it. This firewall has been reset already so I do not have to reset it again. To be able to connect to the Fortigate firewall, I had to change my IP address to ‘192.168.1.X’ subnet since the default web interface IP of Fortigate machine after factory reset is ‘192.168.1.99’. I changed it <strong>‘nmtui’</strong> utility since this is much easier for me.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/252/1*Fd7AHHeHIBk71px7sGlATw.png" /><figcaption>Image 3</figcaption></figure><figure><img alt="" src="https://cdn-images-1.medium.com/max/268/1*XlK3AUAIxPdGbxdWagZ1Zg.png" /><figcaption>Image 4</figcaption></figure><figure><img alt="" src="https://cdn-images-1.medium.com/max/595/1*tnTiZl15r3ksATIqXTiL_Q.png" /><figcaption>Image 5</figcaption></figure><p>After changing the IP address to 192.168.1.2, I was able to access the Fortigate firewall web IP through 192.168.1.99.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/894/1*w1EJhVcsxeu2MIKxxs8rJw.png" /><figcaption>Image 6</figcaption></figure><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*wM1Y4LvpnvILakssX1zTVQ.png" /><figcaption>Image 6</figcaption></figure><p>Navigated to System -&gt; Settings to change the hostname first, and to easily identify the device from the network. I changed it to HOMEFGFW01. If you are doing this, make sure to check your Timezone and NTP server settings as this is extremely important. For other settings like HTTP/S port numbers, I left it as default.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*OCQxgmKBNHSFIja7a_KVOw.png" /><figcaption>Image 7</figcaption></figure><p>After this, I went ahead to do the config for the interfaces. As you see below, there is the default IP address for the MGMT interface and there is also an automatic IP assigned to the the WAN1 interface. The reason is because I plugged in my ISP device to the WAN1 port of this firewall, which makes it have a internet connection. Note that not all ISP devices are able to connect to any devices right away so be sure to check with your local provider.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*UqnLA5NVQF_bKeFEtb46kw.png" /><figcaption>Image 8</figcaption></figure><p>I changed the MGMT IP to the MGMT VLAN network mask that I just created from the Cisco switch earlier. You can also add some Trusted Host IP/mask to this interface if you prefer having it so. I changed the administrative access settings to only HTTPS for web access, PING for testing purposes, and SSH for testing and remote connection.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*8Yak_dd0YISJ0eVgLOHO5Q.png" /><figcaption>Image 9</figcaption></figure><p>At this point, I added all the remaining physical ports to the role LAN of this interface.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*oot7Yf5ijZzcNN4c3GjGWg.png" /><figcaption>Image 10</figcaption></figure><p>Next is I have opened the outbound static network connection from the gateway of this firewall, which is 192.168.1.254 at this point. This will ensure that you can access the internet from your network. I created a policy from the<strong> System -&gt; Policy&amp;Objects -&gt; IPv4 Policy and named it ALL-ALL.</strong></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*tIGE05zXspUOi2x993CVvA.png" /><figcaption>Image 11</figcaption></figure><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*kv4_tXsgQJL3TXp_0SMg2Q.png" /><figcaption>Image 12</figcaption></figure><p>Now, from here, I was able to create, edit, clone, and rename this or any new policies into whatever policies I have to create. From my current ALL-ALL policy, right click into it, click Copy, and Paste it Above or Below. This means that you decide which policy should overrule one another. As you may have know already. Policies and ACL follows the top to bottom rule.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1002/1*oAkoVWvKdpK8y1uGjuMSmQ.png" /><figcaption>Image 13</figcaption></figure><p>I created the HTTP/HTTPS policy next, assigned the Incoming Interface, which is the LAN network, Outgoing Interface, and Source/Destination to ALL and ALL. I then created one for the DNS.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*iWtOEz66G8HAOXPV5qfZdQ.png" /><figcaption>Image 14</figcaption></figure><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*TWlecYTf5ZwwC34J-VUKtA.png" /><figcaption>Image 15</figcaption></figure><p>After I created my policies, I enabled them to apply the changes.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/775/1*wXVf4kwShmPDZeMQCpKLBA.png" /><figcaption>Image 16</figcaption></figure><p>And voila! I now have my simple and basic production HOMELAB network, imitating a small office network that can cater about 10–15 people. This may not be perfect at all but at least it is working. If you notice something to improve from this or any suggestion from improvements, I am open to anything. Please do leave a clap or comment, and share with someone if you think this is interesting. Follow me for more networking, system administration, and IoT related articles. Until next time!</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=79bf3c664fc2" width="1" height="1" alt="">
