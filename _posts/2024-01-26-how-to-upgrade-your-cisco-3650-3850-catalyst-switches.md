---
layout: post
title: How to upgrade your Cisco 3650/3850 Catalyst switches
---

<figure><img alt="" src="https://cdn-images-1.medium.com/max/640/1*2ss1IfzDidEqGuYN9CepPQ.jpeg" /></figure><p>YOU! Yes, you! Yeah, I know you have spent countless hours to find out more information about upgrading Cisco switch stacks firmware guide and it is rare to find and you had to scour all over the internet to find the easiest to understand procedural guidelines to upgrade your Cisco Catalyst 3650/3850. So let’s cut to the chase and get started.</p><p>Side note: You can get your <a href="https://amzn.to/3uf27rN">Catalyst 3850 48P PoE here</a>. (Please support.)</p><p>Here is a general guideline on how to upgrade Catalyst 3650/3850 version upgrade.</p><p>First thing you have to know is that there are two modes of operation, Install mode and Bundle mode.</p><blockquote><strong>Install Mode</strong></blockquote><blockquote>The Install mode uses a package-provisioning file named packages.conf in order to boot a switch. In addition, there are a number of .pkg files in the flash drive. It is highly recommended that you do not alter the packages.conf and .pkg files unless directed by a Cisco Technical Assistance Center (TAC) engineer.</blockquote><blockquote><strong>Bundle Mode</strong></blockquote><blockquote>The Bundle mode uses old Cisco IOS images to boot a switch. The Bundle mode consumes more memory than the Install mode because the packages are extracted from the bundle and copied to RAM.</blockquote><p>So what is their difference? Why use one after the other?</p><blockquote>It is mainly because of their speed. As it suggest from the explanation above, Bundle Mode uses more RAM power than the Install mode.</blockquote><h3>Prepare in advance</h3><p>1. First is to download your target software version from <a href="https://software.cisco.com/download/home">https://software.cisco.com/download/home</a></p><p>2. From your switch, do a show version</p><blockquote>Switch#show version<br> &lt;snip&gt;<br> Switch Ports Model SW Version SW Image Mode <br> — — — — — — — — — — — — — — — — — — — — — <br> * 1 52 WS-C3650–48TD 03.06.07E cat3k_caa-universalk9 INSTALL &lt;&lt;&lt;<br> <br> Switch#show version<br> &lt;snip&gt;<br> Switch Ports Model SW Version SW Image Mode <br> — — — — — — — — — — — — — — — — — — — — — <br> * 1 28 WS-C3650–24TD 03.06.09.E cat3k_caa-universalk9 BUNDLE &lt;&lt;&lt;</blockquote><p>3. Ensure there is enough space in flash:</p><pre>Switch# dir flash:<br><br>Directory of flash:/<br><br>&lt;snip&gt;<br><br>1621966848 bytes total (598597632 bytes free)  &lt;&lt;&lt;&lt;</pre><p>4. Copy the target image file to the device’s flash: via TFTP/FTP/USB, etc.</p><pre>Switch# copy tftp://x.x.x.x/cat3k_caa-universalk9.16.03.05.SPA.bin flash:cat3k_caa-universalk9.16.03.05.SPA.bin</pre><pre>Destination filename [cat3k_caa-universalk9.16.03.05.SPA.bin]?</pre><pre>Accessing tftp://x.x.x.x/cat3k_caa-universalk9.16.03.05.SPA.bin...</pre><pre>Loading cat3k_caa-universalk9.16.03.05.SPA.bin from x.x.x.x (via GigabitEthernet0/0):</pre><pre>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</pre><pre>[OK - 489159804 bytes]</pre><pre>489159804 bytes copied in 143.802 secs (3401620 bytes/sec)</pre><pre>Switch#</pre><h3>Upgrading from 3.x to 16.x</h3><h4>Upgrade from Install mode to Install mode</h4><p>1. Make sure it is running in Install mode in advance.</p><pre>Switch#show version | in INSTALL</pre><pre> *    2 56    WS-C3850-48P       03.06.06E         cat3k_caa-universalk9 INSTALL</pre><p>2. Execute the software install command and reload the device.</p><pre>Switch#software install file flash:cat3k_caa-universalk9.16.03.03.SPA.bin new force<br><br>Preparing install operation ...<br><br>[2]: Starting install operation<br><br>[2]: Expanding bundle flash:cat3k_caa-universalk9.16.03.03.SPA.bin<br><br>[2]: Copying package files<br><br>[2]: Package files copied<br><br>[2]: Finished expanding bundle flash:cat3k_caa-universalk9.16.03.03.SPA.bin<br><br>[2]: Verifying and copying expanded package files to flash:<br><br>[2]: Verified and copied expanded package files to flash:<br><br>[2]: Starting compatibility checks<br><br>[2]: Bypassing peer package compatibility checks due to &#39;force&#39; command option<br><br>[2]: Finished compatibility checks<br><br>[2]: Starting application pre-installation processing<br><br>[2]: Old files list:<br><br>    Removed cat3k_caa-base.SPA.03.06.06E.pkg<br><br>    Removed cat3k_caa-drivers.SPA.03.06.06E.pkg<br><br>    Removed cat3k_caa-infra.SPA.03.06.06E.pkg<br><br>    Removed cat3k_caa-iosd-universalk9.SPA.152-2.E6.pkg<br><br>    Removed cat3k_caa-platform.SPA.03.06.06E.pkg<br><br>    Removed cat3k_caa-wcm.SPA.10.2.160.0.pkg<br><br>[2]: New files list:<br><br>    Added cat3k_caa-guestshell.16.03.03.SPA.pkg<br><br>    Added cat3k_caa-rpbase.16.03.03.SPA.pkg<br><br>    Added cat3k_caa-rpcore.16.03.03.SPA.pkg<br><br>    Added cat3k_caa-srdriver.16.03.03.SPA.pkg<br><br>    Added cat3k_caa-wcm.16.03.03.SPA.pkg<br><br>    Added cat3k_caa-webui.16.03.03.SPA.pkg<br><br>[2]: Creating pending provisioning file<br><br>[2]: Finished installing software.  New software will load on reboot.<br><br>[2]: Committing provisioning file<br><br>[2]: Do you want to proceed with reload? [yes/no]: y<br><br>[2]: Reloading<br><br><br><br>%IOSXEBOOT-4-FLASH: (rp/0): deleting cat3k_caa-universalk9.16.03.03.SPA.bin because free space on flash is less than 300MB<br><br>%IOSXEBOOT-8e30b253627ff1aae4fee6643a923d8a-new_cksum: (rp/0): 4<br><br>%IOSXEBOOT-8e30b253627ff1aae4fee6643a923d8a-saved_cksum: (rp/0): 4<br><br>%IOSXEBOOT-Fri-###: (rp/0): Mar 17 16:27:16 Universal 2017 PLEASE DO NOT POWER CYCLE ### BOOT LOADER UPGRADING 4<br><br>%IOSXEBOOT-loader-boot: (rp/0): upgrade successful <br><br>Front-end Microcode IMG MGR: Programming device 0...rwRrrrrrrw..0%.........................................................................10%........................................................................20%..........................................................................30%........................................................................40%........................................................................50%..........................................................................60%.........................................................................70%........................................................................80%............................................................................................................................................90%........................................................................100%<br><br>Front-end Microcode IMG MGR: Preparing to program device[0]...25166 bytes.<br><br>Front-end Microcode IMG MGR: Programming device 0...rrrrrrw..0%....10%....20%......30%...40%......50%....60%......70%...80%......90%....100%wRr!<br><br>Front-end Microcode IMG MGR: Microcode programming complete for device 0.<br><br>Front-end Microcode IMG MGR: Preparing to program device[0]...86370 bytes.... Skipped[3].<br><br>Front-end Microcode IMG MGR: Microcode programming complete in 244 seconds</pre><p>Ensure there is enough space in flash:</p><p>3. After starting the device, check the version information using show version.</p><pre>Switch#show version | in IOS</pre><pre>Cisco IOS Software [Denali], Catalyst L3 Switch Software (CAT3K_CAA-UNIVERSALK9-M), Version 16.3.3, RELEASE SOFTWARE (fc3)</pre><pre>Cisco IOS-XE software, Copyright (c) 2005-2017 by cisco Systems, Inc.</pre><blockquote><strong>Note: It is mandatory to use the keywords “new” and “force” when upgrading from 3.6.X to 16.X. If “new” and “force” are missing, the following error may occur and the program may not run properly.</strong></blockquote><pre>Switch#software install file flash:cat3k_caa-universalk9.16.03.03.SPA.bin<br><br>Preparing install operation ...<br><br>[2]: Starting install operation<br><br>[2]: Expanding bundle flash:cat3k_caa-universalk9.16.03.03.SPA.bin<br><br>[2]: Copying package files<br><br>[2]: Package files copied<br><br>[2]: Finished expanding bundle flash:cat3k_caa-universalk9.16.03.03.SPA.bin<br><br>[2]: Verifying and copying expanded package files to flash:<br><br>[2]: Verified and copied expanded package files to flash:<br><br>[2]: Starting compatibility checks<br><br>[2]: % Candidate package compatibility checks failed because the following<br><br>       package dependencies were not satisfied. Operation aborted.<br><br>[2]: % An internal error was encountered. Operation aborted.</pre><blockquote>If the above error occurs, you need to perform a “software clean” and re-copy the image, and then repeat the steps with “new” and “force”.</blockquote><pre>Switch#software clean<br><br>Preparing clean operation ...<br><br>[2]: Cleaning up unnecessary package files<br><br>[2]: No path specified, will use booted path flash:packages.conf<br><br>[2]: Cleaning flash:<br><br>[2]: Preparing packages list to delete ...<br><br>     In use files, will not delete:<br><br>       cat3k_caa-base.SPA.03.06.06E.pkg<br><br>       cat3k_caa-drivers.SPA.03.06.06E.pkg<br><br>       cat3k_caa-infra.SPA.03.06.06E.pkg<br><br>       cat3k_caa-iosd-universalk9.SPA.152-2.E6.pkg<br><br>       cat3k_caa-platform.SPA.03.06.06E.pkg<br><br>       cat3k_caa-wcm.SPA.10.2.160.0.pkg<br><br>       packages.conf<br><br>[2]: Files that will be deleted:<br><br>    cat3k_caa-guestshell.16.03.03.SPA.pkg<br><br>    cat3k_caa-rpbase.16.03.03.SPA.pkg<br><br>    cat3k_caa-rpcore.16.03.03.SPA.pkg<br><br>    cat3k_caa-srdriver.16.03.03.SPA.pkg<br><br>    cat3k_caa-universalk9.16.03.03.SPA.bin<br><br>    cat3k_caa-wcm.16.03.03.SPA.pkg<br><br>    cat3k_caa-webui.16.03.03.SPA.pkg<br><br>[2]: Do you want to proceed with the deletion? [yes/no]: y<br><br>[2]: Clean up completed</pre><pre>&lt;snip&gt;</pre><h4>Upgrade from Bundle mode to Install mode</h4><p>1. Make sure it is running in Bundle mode in advance.</p><pre>Switch#show version | in BUNDLE</pre><pre>*    2 56    WS-C3850-48P       03.06.06.E        cat3k_caa-universalk9 BUNDLE</pre><p>2. Convert the .bin file to a Package file using the software expand command.</p><pre>Switch#software expand file flash:cat3k_caa-universalk9.16.03.03.SPA.bin to flash:<br><br>Preparing expand operation ...<br><br>[2]: Expanding bundle flash:cat3k_caa-universalk9.16.03.03.SPA.bin<br><br>[2]: Copying package files<br><br>[2]: Package files copied<br><br>[2]: Finished expanding bundle flash:cat3k_caa-universalk9.16.03.03.SPA.bin</pre><p>3. Verify that the packages.conf file has been generated in flash:.</p><pre>Switch#directory | in packages.conf<br><br>30979  -rw-        1236  Dec 22 2015 13:16:22 -04:00  packages.conf</pre><p>4. Change the Boot variable and execute write memory.</p><pre>Switch#configure terminal</pre><pre>Enter configuration commands, one per line.  End with CNTL/Z.</pre><pre>Switch(config)#no boot system</pre><pre>Switch(config)#boot system flash:packages.conf</pre><pre>Switch(config)#end</pre><pre>Switch#write memory</pre><pre>Switch#show boot</pre><pre>---------------------------</pre><pre>Switch 1</pre><pre>---------------------------</pre><pre>Current Boot Variables:</pre><pre>BOOT variable = flash:packages.conf;</pre><pre>Boot Variables on next reload:</pre><pre>BOOT variable = flash:packages.conf;</pre><pre>&lt;snip&gt;</pre><p>5. Reload the device.</p><pre>Switch#show version | in IOS</pre><pre>Cisco IOS Software [Denali], Catalyst L3 Switch Software (CAT3K_CAA-UNIVERSALK9-M), Version 16.3.3, RELEASE SOFTWARE (fc3)</pre><pre>Cisco IOS-XE software, Copyright (c) 2005-2017 by cisco Systems, Inc.</pre><p>6. After starting the device, check the version information using show version.</p><pre>Switch#show version | in IOS</pre><pre>Cisco IOS Software [Denali], Catalyst L3 Switch Software (CAT3K_CAA-UNIVERSALK9-M), Version 16.3.3, RELEASE SOFTWARE (fc3)</pre><pre>Cisco IOS-XE software, Copyright (c) 2005-2017 by cisco Systems, Inc.</pre><h3>Upgrading from Install/Bundle mode to Bundle mode</h3><p>1. Make sure that the target file has been copied to flash:.</p><pre>Switch#dir flash:</pre><pre>31053  -rw-      537337933   Aug 9 2019 07:39:24 +00:00  cat3k_caa-universalk9.16.03.09.SPA.bin</pre><p>2. Change the Boot variable and execute write memory.</p><pre>Switch#configure terminal</pre><pre>Enter configuration commands, one per line.  End with CNTL/Z.</pre><pre>Switch(config)#no boot system</pre><pre>Switch(config)#boot system flash:cat3k_caa-universalk9.16.03.09.SPA.bin</pre><pre>Switch(config)#end</pre><pre>Switch#write memory</pre><pre>Switch#show boot</pre><pre>---------------------------</pre><pre>Switch 1</pre><pre>---------------------------</pre><pre>Current Boot Variables:</pre><pre>BOOT variable = flash:cat3k_caa-universalk9.16.03.09.SPA.bin;</pre><pre>Boot Variables on next reload:</pre><pre>BOOT variable = flash:cat3k_caa-universalk9.16.03.09.SPA.bin;</pre><pre>&lt;snip&gt;</pre><p>3. Reload the device.</p><pre>Switch#reload</pre><pre>Proceed with reload? [confirm]</pre><p>4. After starting the device, check the version information using show version.</p><pre>Switch#show version</pre><pre>&lt;snip&gt;</pre><pre>Switch Ports Model              SW Version        SW Image              Mode  </pre><pre>------ ----- -----              ----------        ----------            ----  </pre><pre>*    1 32    WS-C3850-24T       16.3.9           CAT3K_CAA-UNIVERSALK9 BUNDLE</pre><h3>Upgrading from 16.X to 16.X</h3><h4>Upgrade from Install mode to Install mode</h4><p>1. Make sure it is running in Install mode in advance.</p><pre>switch#show version</pre><pre>&lt;snip&gt;</pre><pre>Switch Ports Model              SW Version        SW Image              Mode  </pre><pre>------ ----- -----              ----------        ----------            ----  </pre><pre>*    1 28    WS-C3650-24TS      16.5.1a            CAT3K_CAA-UNIVERSALK9 INSTALL</pre><p>2. Execute the following command.</p><pre>Switch#request platform software package install switch all file flash:cat3k_caa-universalk9.16.03.03.SPA.bin</pre><pre>[1]: Expanding file</pre><pre>[1]: Performing install</pre><pre>[1]: install package(s) on switch 1</pre><pre>Old files list:</pre><pre> Removed cat3k_caa-guestshell.16.05.01a.SPA.pkg</pre><pre> Removed cat3k_caa-rpbase.16.05.01a.SPA.pkg</pre><pre> Removed cat3k_caa-rpcore.16.05.01a.SPA.pkg</pre><pre> Removed cat3k_caa-srdriver.16.05.01a.SPA.pkg</pre><pre> Removed cat3k_caa-webui.16.05.01a.SPA.pkg</pre><pre>New files list:</pre><pre> Added cat3k_caa-guestshell.16.03.03.SPA.pkg</pre><pre> Added cat3k_caa-rpbase.16.03.03.SPA.pkg</pre><pre> Added cat3k_caa-rpcore.16.03.03.SPA.pkg</pre><pre> Added cat3k_caa-srdriver.16.03.03.SPA.pkg</pre><pre> Added cat3k_caa-wcm.16.03.03.SPA.pkg</pre><pre> Added cat3k_caa-webui.16.03.03.SPA.pkg</pre><pre>Finished list of software package changes</pre><pre>SUCCESS: Software provisioned. New software will load on reboot.</pre><pre>[1]: Finished install successful on switch 1</pre><pre>Checking status of install on [1]</pre><pre>[1]: Finished install in switch 1</pre><pre>SUCCESS: Finished install: Success on [1]</pre><p>3. Reload the device.</p><pre>Switch#reload</pre><pre>Reload command is being issued on Active unit, this will reload the whole stack</pre><pre>Proceed with reload? [confirm]</pre><p>4. After starting the device, check the version information using show version.</p><pre>Switch#show version</pre><pre>&lt;snip&gt;</pre><pre>Switch Ports Model              SW Version        SW Image              Mode  </pre><pre>------ ----- -----              ----------        ----------            ----  </pre><pre>*    1 28    WS-C3650-24TS      16.3.3            CAT3K_CAA-UNIVERSALK9 INSTALL</pre><h4>Upgrade from Bundle mode to Install mode</h4><p>1. Make sure it is running in Bundle mode in advance.</p><pre>Switch#show ver | in BUNDLE</pre><pre>     1 32    WS-C3850-24T       16.3.8            CAT3K_CAA-UNIVERSALK9 BUNDLE</pre><p>2. Convert the bin file to Package using the request platform software package expand command.</p><pre>Switch#request platform software package expand switch all file flash:cat3k_caa-universalk9.16.06.05.SPA.bin</pre><pre>[2]: Expanding file</pre><pre>[2]: Finished expanding all-in-one software package in switch 1</pre><pre>SUCCESS: Finished expanding all-in-one software package.</pre><pre>Switch#</pre><p>3. Verify that the packages.conf file has been generated in flash:.</p><pre>Switch#dir | in packages.conf</pre><pre>30994  -rw-             4742  Aug 19 2019 05:51:43 +00:00  packages.conf</pre><p>4. Change the Boot variable and execute write memory.</p><pre>Switch#configure terminal</pre><pre>Enter configuration commands, one per line.  End with CNTL/Z.</pre><pre>Switch(config)#no boot system</pre><pre>Switch(config)#boot system flash:packages.conf</pre><pre>Switch(config)#end</pre><pre>Switch#write memory</pre><pre>Switch#show boot</pre><pre>---------------------------</pre><pre>Switch 1</pre><pre>---------------------------</pre><pre>Current Boot Variables:</pre><pre>BOOT variable = flash:packages.conf;</pre><pre>Boot Variables on next reload:</pre><pre>BOOT variable = flash:packages.conf;</pre><pre>&lt;snip&gt;</pre><p>5. Reload the device.</p><pre>Switch#reload</pre><pre>Proceed with reload? [confirm]</pre><h3>Upgrading from Install/Bundle mode to Bundle mode</h3><p>The steps are the same as in “Upgrading from 3.X to 16.X” &gt; “Upgrading from Install/Bundle mode to Bundle mode” above. See above.</p><p>Below are the commands related to upgrading versions above 3.X and 16.X.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*KqoQ5Zmfll0RQgXPFX1jIg.png" /></figure><p>And there you have it! Easiest way to have your Cisco Catalyst switches on hand! Be sure to follow for more content like this.</p><h3>References:</h3><h4>Release Notes for Cisco Catalyst 3650 Series Switches, Cisco IOS XE Denali 16.3.x<br> Upgrading the Switch Software</h4><p><a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3650/software/release/16-3/release_notes/ol-16-3-3650.html#pgfId-1118681">https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3650/software/release/16-3/release_notes/ol-16-3-3650.html#pgfId-1118681</a></p><h4>Switch Stack Update</h4><p><a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3850/software/release/16-1/best_practices_guide/BP_Cat3850/BP_stack_upgrade.pdf?dtid=osscdc000283">https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3850/software/release/16-1/best_practices_guide/BP_Cat3850/BP_stack_upgrade.pdf?dtid=osscdc000283</a></p><h4>Catalyst 3850 シリーズ スイッチのアップグレード、管理、および回復の方法</h4><p><a href="https://www.cisco.com/c/ja_jp/support/docs/switches/catalyst-3850-series-switches/117552-technote-cat3850-00.html?dtid=osscdc000334">https://www.cisco.com/c/ja_jp/support/docs/switches/catalyst-3850-series-switches/117552-technote-cat3850-00.html?dtid=osscdc000334</a></p><h4>Cisco Content Hub</h4><p><a href="https://content.cisco.com/chapter.sjs?uri=/searchable/chapter/c/en/us/td/docs/switches/lan/Denali_16-1/ConfigExamples_Technotes/Config_Examples/Misc/qos/m_install_vs_bundle.html.xml">https://content.cisco.com/chapter.sjs?uri=/searchable/chapter/c/en/us/td/docs/switches/lan/Denali_16-1/ConfigExamples_Technotes/Config_Examples/Misc/qos/m_install_vs_bundle.html.xml</a></p><h4>Cisco Community</h4><p><a href="https://community.cisco.com/t5/tkb-%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9-%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88/catalyst3650-catalyst3850-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E6%89%8B%E9%A0%86/ta-p/3917918">https://community.cisco.com/t5/tkb-%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9-%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88/catalyst3650-catalyst3850-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E6%89%8B%E9%A0%86/ta-p/3917918</a></p><h4>LearnDuty</h4><p><a href="https://learnduty.com/network-techs/catalyst-3850-upgrade-process-step-by-step/">https://learnduty.com/network-techs/catalyst-3850-upgrade-process-step-by-step/</a></p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=dec09610d767" width="1" height="1" alt="">
